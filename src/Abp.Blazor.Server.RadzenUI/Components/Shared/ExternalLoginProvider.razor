@using Microsoft.AspNetCore.Authentication

@if (ExternalProviders.Count > 0)
{
    <Devider />
    @foreach (var provider in ExternalProviders)
    {
        <RadzenTemplateForm Data=@("") Method="post" Action="/account/externallogin" class="rz-mb-2">
            <input type="hidden" name="returnUrl" value="/" />
            <input type="hidden" name="provider" value="@provider.AuthenticationScheme" />
            <RadzenButton ButtonType="ButtonType.Submit" Text="@provider.DisplayName" Style="width:100%"
                          Image="_content/AbpRadzen.Blazor.Server.UI/images/microsoft-logo.svg" />
        </RadzenTemplateForm>
    }
}

@code {
    [Inject]
    IAuthenticationSchemeProvider SchemeProvider { get; set; } = default!;

    List<ExternalProviderModel> ExternalProviders { get; set; } = [];

    protected override async Task OnInitializedAsync()
    {
        ExternalProviders = await GetExternalProviders();
    }

    async Task<List<ExternalProviderModel>> GetExternalProviders()
    {
        var schemes = await SchemeProvider.GetAllSchemesAsync();

        return
            [
            .. schemes
            .Where(x => x.DisplayName != null)
            .Select(x => new ExternalProviderModel
                {
                    DisplayName = x.DisplayName,
                    AuthenticationScheme = x.Name
                })
        ];
    }
}
