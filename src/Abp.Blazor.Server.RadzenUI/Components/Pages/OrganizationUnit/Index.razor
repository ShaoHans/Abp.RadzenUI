@page "/organization-units"
@using Abp.RadzenUI.Application.Contracts.Organizations
@inherits AbpCrudPageBase<IOrganizationUnitAppService, OrganizationUnitDto, Guid, OrganizationUnitGetListInput, OrganizationUnitCreateDto, OrganizationUnitUpdateDto>

<RadzenCardGroup Responsive="true">
    <RadzenCard Variant="Variant.Filled" Style="margin-right:10px;">
        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" Gap="1rem">
            <RadzenText Text="@L["Ou:Tree"]" TextAlign="TextAlign.Start" />
            <RadzenButton Text="@L["Ou:NewRootOu"]" Icon="add"
                          Click="@(async () => await OpenCreateDialogAsync<CreateOu>(L["Ou:NewOu.Title"], callback:LoadOuAsync))" />
        </RadzenStack>
        
        <RadzenTree Style="width: 100%; height: 100%"
                    Data=@_ouTree @bind-Value="@_selectedOu">
            <RadzenTreeLevel TextProperty="@nameof(OrganizationUnitTreeItemVm.DisplayName)"
                             ChildrenProperty="@nameof(OrganizationUnitTreeItemVm.Children)"
                             Expanded="(i=>true)"
                             HasChildren="(i=>((OrganizationUnitTreeItemVm)i).Children.Count>0)">
                <Template>
                    @{
                        var treeItem = (OrganizationUnitTreeItemVm)context.Value;
                        <RadzenSplitButton Text="@treeItem.DisplayName" Variant="Variant.Text" Icon="lan"
                                           Click=@(args => TreeItemOnClick(args, "SplitButton with icon"))>
                            <ChildContent>
                                <RadzenSplitButtonItem Text="@L["Ou:EditRootOu"]" Icon="edit" Value="@OuTreeItemAction.Edit.ToString()" />
                                <RadzenSplitButtonItem Text="@L["Ou:NewSubOu"]" Icon="add" Value="@OuTreeItemAction.AddSubOu.ToString()" />
                            </ChildContent>
                        </RadzenSplitButton>
                    }
                </Template>
            </RadzenTreeLevel>
        </RadzenTree>
    </RadzenCard>

    <RadzenCard Variant="Variant.Filled">
        <RadzenTabs>
            <Tabs>
                <RadzenTabsItem Text="@L["Ou:Members"]">
                    @if (_selectedOu == null)
                    {
                        <RadzenText Text="@L["Ou:Member.Tooltip"]" TextAlign="TextAlign.Start" />
                    }
                    else
                    {
                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" Gap="1rem">
                            <RadzenText Text="@GetSelectedOu()!.DisplayName" TextAlign="TextAlign.Start" />
                            <RadzenButton Text="@L["Ou:Member.Add"]" Icon="add"
                                           />
                        </RadzenStack>
                    }
                </RadzenTabsItem>
                <RadzenTabsItem Text="@L["Ou:Roles"]">
                    @if (_selectedOu == null)
                    {
                        <RadzenText Text="@L["Ou:Role.Tooltip"]" TextAlign="TextAlign.Start" />
                    }
                    else
                    {
                        <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" Gap="1rem">
                            <RadzenText Text="@GetSelectedOu()!.DisplayName" TextAlign="TextAlign.Start" />
                            <RadzenButton Text="@L["Ou:Role.Add"]" Icon="add" />
                        </RadzenStack>
                    }
                </RadzenTabsItem>
            </Tabs>
        </RadzenTabs>
    </RadzenCard>
</RadzenCardGroup>